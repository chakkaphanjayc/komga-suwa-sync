<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Komga-Suwayomi Sync Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.0/socket.io.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="dark-mode">
    <div class="container">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-sync-alt"></i> Komga-Suwayomi Sync</h1>
                <div class="header-controls">
                    <button id="theme-toggle" class="theme-toggle" title="Toggle Dark/Light Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="status-bar">
                        <span id="sync-status" class="status">Status: <span class="status-text">Unknown</span></span>
                        <span id="sync-direction-status" class="status">Direction: <span class="status-text" id="sync-direction-text">Bidirectional</span></span>
                        <span id="last-sync" class="status">Last Sync: <span class="status-text">Never</span></span>
                        <span id="next-sync" class="status">Next Sync: <span class="status-text countdown" id="sync-countdown">--:--</span></span>
                    </div>
                </div>
            </div>
        </header>

        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
            <button class="tab-btn" data-tab="manga-lists">Manga Lists</button>
            <button class="tab-btn" data-tab="configuration">Configuration</button>
            <button class="tab-btn" data-tab="mappings">Mappings</button>
        </nav>

        <main>
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-book"></i></div>
                        <h3>Series Mappings</h3>
                        <div class="stat-number" id="series-count">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-file-alt"></i></div>
                        <h3>Chapter Mappings</h3>
                        <div class="stat-number" id="chapter-count">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                        <h3>Sync Cycles</h3>
                        <div class="stat-number" id="sync-cycles">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <h3>Errors</h3>
                        <div class="stat-number error" id="error-count">-</div>
                    </div>
                </div>

                <div class="control-panel">
                    <h3><i class="fas fa-cogs"></i> Sync Controls</h3>
                    <div class="control-buttons">
                        <button id="start-sync" class="btn btn-success">
                            <i class="fas fa-play"></i> Start Sync
                        </button>
                        <button id="stop-sync" class="btn btn-danger">
                            <i class="fas fa-stop"></i> Stop Sync
                        </button>
                        <button id="run-match" class="btn btn-secondary">
                            <i class="fas fa-search"></i> Run Initial Match
                        </button>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <!-- Recent Activity -->
                    <div class="dashboard-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-history"></i> Recent Activity</h3>
                            <div class="panel-controls">
                                <input type="text" id="activity-search" placeholder="Search activity..." class="search-input">
                                <button id="clear-activity" class="btn btn-small">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div id="activity-log" class="activity-list"></div>
                    </div>

                    <!-- Sync Log -->
                    <div class="dashboard-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-terminal"></i> Sync Log</h3>
                            <div class="panel-controls">
                                <select id="log-filter">
                                    <option value="all">All Levels</option>
                                    <option value="error">Errors Only</option>
                                    <option value="warn">Warnings+</option>
                                    <option value="info">Info+</option>
                                    <option value="debug">Debug+</option>
                                </select>
                                <button id="clear-logs" class="btn btn-small">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div id="logs-container" class="logs-container"></div>
                    </div>

                    <!-- API Debug -->
                    <div class="dashboard-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-bug"></i> API Debug</h3>
                        </div>
                        <div class="api-debug-grid">
                            <div class="api-section">
                                <h4>Komga API Status</h4>
                                <div class="api-status" id="komga-status">
                                    <div class="status-indicator">
                                        <span class="status-dot" id="komga-dot"></span>
                                        <span class="status-text" id="komga-status-text">Checking...</span>
                                        <button id="test-komga" class="btn btn-small">Test</button>
                                        <button id="open-komga" class="btn btn-small btn-outline" title="Open Komga">
                                            <i class="fas fa-external-link-alt"></i>
                                        </button>
                                    </div>
                                    <div class="api-details" id="komga-details"></div>
                                </div>
                            </div>

                            <div class="api-section">
                                <h4>Suwayomi API Status</h4>
                                <div class="api-status" id="suwa-status">
                                    <div class="status-indicator">
                                        <span class="status-dot" id="suwa-dot"></span>
                                        <span class="status-text" id="suwa-status-text">Checking...</span>
                                        <button id="test-suwa" class="btn btn-small">Test</button>
                                        <button id="open-suwayomi" class="btn btn-small btn-outline" title="Open Suwayomi">
                                            <i class="fas fa-external-link-alt"></i>
                                        </button>
                                    </div>
                                    <div class="api-details" id="suwa-details"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="manga-lists" class="tab-content">
                <div class="manga-lists-grid">
                    <div class="manga-section">
                        <h3>Komga Series</h3>
                        <div class="manga-controls">
                            <button id="refresh-komga-manga" class="btn btn-primary">Refresh Komga Manga</button>
                            <input type="text" id="komga-search" placeholder="Search Komga series..." class="manga-search">
                            <span id="komga-count">0 series</span>
                        </div>
                        <div class="manga-list" id="komga-manga-list">
                            <!-- Komga manga will be displayed here -->
                        </div>
                    </div>

                    <div class="manga-section">
                        <h3>Suwayomi Manga</h3>
                        <div class="manga-controls">
                            <button id="refresh-suwayomi-manga" class="btn btn-primary">Refresh Suwayomi Manga</button>
                            <input type="text" id="suwayomi-search" placeholder="Search Suwayomi manga..." class="manga-search">
                            <span id="suwayomi-count">0 manga</span>
                        </div>
                        <div class="manga-list" id="suwayomi-manga-list">
                            <!-- Suwayomi manga will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuration Tab -->
            <div id="configuration" class="tab-content">
                <div class="config-grid">
                    <!-- Komga Configuration -->
                    <div class="config-section">
                        <h3><i class="fas fa-server"></i> Komga Configuration</h3>
                        <form id="komga-config">
                            <div class="form-group">
                                <label for="komga-base">Base URL:</label>
                                <input type="text" id="komga-base" name="komga-base" required>
                            </div>
                            <div class="form-group">
                                <label for="komga-user">Username:</label>
                                <input type="text" id="komga-user" name="komga-user" required>
                            </div>
                            <div class="form-group">
                                <label for="komga-pass">Password:</label>
                                <input type="password" id="komga-pass" name="komga-pass" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Komga Config
                            </button>
                        </form>
                    </div>

                    <!-- Suwayomi Configuration -->
                    <div class="config-section">
                        <h3><i class="fas fa-mobile-alt"></i> Suwayomi Configuration</h3>
                        <form id="suwa-config">
                            <div class="form-group">
                                <label for="suwa-base">Base URL:</label>
                                <input type="text" id="suwa-base" name="suwa-base" required>
                            </div>
                            <div class="form-group">
                                <label for="suwa-user">Username:</label>
                                <input type="text" id="suwa-user" name="suwa-user" required>
                            </div>
                            <div class="form-group">
                                <label for="suwa-pass">Password:</label>
                                <input type="password" id="suwa-pass" name="suwa-pass" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Suwayomi Config
                            </button>
                        </form>
                    </div>

                    <!-- Sync Configuration -->
                    <div class="config-section">
                        <h3><i class="fas fa-sliders-h"></i> Sync Configuration</h3>
                        <form id="sync-config">
                            <div class="form-group">
                                <label for="sync-interval">Event Sync Interval (sec):</label>
                                <input type="number" id="sync-interval" name="sync-interval" min="1" step="1" placeholder="30" required>
                                <small>Interval for checking recent reading activity (in seconds, default: 30s)</small>
                            </div>
                            <div class="form-group">
                                <label for="full-sync-interval">Full Sync Interval (hour):</label>
                                <input type="number" id="full-sync-interval" name="full-sync-interval" min="1" step="1" placeholder="6" required>
                                <small>Interval for full library sync (in hours, default: 6 hours)</small>
                            </div>
                            <div class="form-group">
                                <label for="sync-direction">Sync Direction:</label>
                                <select id="sync-direction" name="sync-direction">
                                    <option value="bidirectional">Bidirectional (Komga ↔ Suwayomi)</option>
                                    <option value="komga-to-suwa">Komga → Suwayomi Only</option>
                                    <option value="suwa-to-komga">Suwayomi → Komga Only</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="fuzzy-threshold">Fuzzy Threshold:</label>
                                <input type="number" id="fuzzy-threshold" name="fuzzy-threshold" step="0.01" min="0" max="1" required>
                            </div>
                            <div class="form-group">
                                <label for="log-level">Log Level:</label>
                                <select id="log-level" name="log-level">
                                    <option value="error">Error</option>
                                    <option value="warn">Warn</option>
                                    <option value="info">Info</option>
                                    <option value="debug">Debug</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dry-run">Dry Run Mode:</label>
                                <input type="checkbox" id="dry-run" name="dry-run">
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Sync Config
                            </button>
                        </form>
                    </div>
                </div>
            </div>





            <div id="mappings" class="tab-content">
                <div class="mappings-controls">
                    <button id="refresh-mappings" class="btn btn-primary">Refresh Mappings</button>
                    <input type="text" id="mapping-search" placeholder="Search mappings...">
                </div>

                <div class="mappings-tables">
                    <div class="mapping-section">
                        <h3>Series Mappings</h3>
                        <div class="table-container">
                            <table id="series-table">
                                <thead>
                                    <tr>
                                        <th>Komga Series</th>
                                        <th>Suwayomi Manga</th>
                                        <th>Normalized Title</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="series-tbody"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="mapping-section">
                        <h3>Chapter Mappings</h3>
                        <div class="table-container">
                            <table id="chapter-table">
                                <thead>
                                    <tr>
                                        <th>Komga Book</th>
                                        <th>Suwayomi Chapter</th>
                                        <th>Chapter #</th>
                                        <th>Last Sync</th>
                                    </tr>
                                </thead>
                                <tbody id="chapter-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="sync-log" class="tab-content">
                <div class="sync-log-controls">
                    <button id="refresh-sync-log" class="btn btn-primary">Refresh Sync Log</button>
                    <button id="trigger-manual-sync" class="btn btn-success">Trigger Manual Sync</button>
                    <button id="sync-komga-to-suwa" class="btn btn-info">Sync Komga → Suwayomi</button>
                    <button id="sync-suwa-to-komga" class="btn btn-info">Sync Suwayomi → Komga</button>
                    <button id="clear-sync-log" class="btn btn-danger">Clear Sync Log</button>
                    <span id="sync-log-status">Loading...</span>
                </div>

                <div class="sync-stats-grid">
                    <div class="sync-stat-card">
                        <h4>Total Mappings</h4>
                        <div class="sync-stat-number" id="total-mappings">-</div>
                    </div>
                    <div class="sync-stat-card">
                        <h4>Synced Komga → Suwayomi</h4>
                        <div class="sync-stat-number" id="synced-komga-to-suwa">-</div>
                    </div>
                    <div class="sync-stat-card">
                        <h4>Synced Suwayomi → Komga</h4>
                        <div class="sync-stat-number" id="synced-suwa-to-komga">-</div>
                    </div>
                    <div class="sync-stat-card">
                        <h4>Never Synced</h4>
                        <div class="sync-stat-number" id="never-synced">-</div>
                    </div>
                </div>

                <div class="recent-sync-activities">
                    <h3>Recent Sync Activities</h3>
                    <div class="sync-activities-columns">
                        <div class="sync-column">
                            <h4>Komga Activities</h4>
                            <div id="komga-sync-entries" class="sync-activities-list">
                                <!-- Komga sync activities will be displayed here -->
                            </div>
                        </div>
                        <div class="sync-column">
                            <h4>Suwayomi Activities</h4>
                            <div id="suwayomi-sync-entries" class="sync-activities-list">
                                <!-- Suwayomi sync activities will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/js/app.js"></script>
</body>
</html>
